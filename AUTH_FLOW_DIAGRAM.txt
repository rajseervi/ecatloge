╔══════════════════════════════════════════════════════════════════════════════╗
║                    AUTHENTICATION FLOW DIAGRAM                                ║
╚══════════════════════════════════════════════════════════════════════════════╝

┌─────────────────────────────────────────────────────────────────────────────┐
│                         USER TRIES TO ACCESS /admin                          │
└────────────────────────────────┬────────────────────────────────────────────┘
                                 │
                                 ▼
                    ┌────────────────────────┐
                    │   MIDDLEWARE CHECK     │
                    │  (src/middleware.ts)   │
                    └────────────┬───────────┘
                                 │
                    ┌────────────┴────────────┐
                    │                         │
                    ▼                         ▼
          ┌──────────────────┐      ┌──────────────────┐
          │  AUTHENTICATED?  │      │  AUTHENTICATED?  │
          │       YES        │      │       NO         │
          └────────┬─────────┘      └────────┬─────────┘
                   │                         │
                   ▼                         ▼
          ┌──────────────────┐      ┌──────────────────┐
          │  ALLOW ACCESS    │      │  CONTINUE TO     │
          │  Show Dashboard  │      │  CLIENT CHECK    │
          └──────────────────┘      └────────┬─────────┘
                                              │
                                              ▼
                                   ┌──────────────────────┐
                                   │  PROTECTED ROUTE     │
                                   │  (Client Component)  │
                                   └──────────┬───────────┘
                                              │
                                              ▼
                                   ┌──────────────────────┐
                                   │  useSession() Hook   │
                                   │  Check Auth Status   │
                                   └──────────┬───────────┘
                                              │
                                 ┌────────────┴────────────┐
                                 │                         │
                                 ▼                         ▼
                      ┌──────────────────┐      ┌──────────────────┐
                      │    LOADING...    │      │ UNAUTHENTICATED  │
                      │  Show Spinner    │      │  Show Auth Page  │
                      └──────────────────┘      └────────┬─────────┘
                                                         │
                                                         ▼
                                              ┌──────────────────────┐
                                              │  "Authentication     │
                                              │   Required" Page     │
                                              │  + "Sign In" Button  │
                                              └──────────┬───────────┘
                                                         │
                                                         ▼
                                              ┌──────────────────────┐
                                              │  USER CLICKS         │
                                              │  "SIGN IN" BUTTON    │
                                              └──────────┬───────────┘
                                                         │
                                                         ▼
                                              ┌──────────────────────┐
                                              │   LOGIN MODAL        │
                                              │   APPEARS            │
                                              └──────────┬───────────┘
                                                         │
                                                         ▼
                                              ┌──────────────────────┐
                                              │  USER ENTERS         │
                                              │  EMAIL & PASSWORD    │
                                              └──────────┬───────────┘
                                                         │
                                                         ▼
                                              ┌──────────────────────┐
                                              │  signIn() Called     │
                                              │  (NextAuth)          │
                                              └──────────┬───────────┘
                                                         │
                                                         ▼
                                              ┌──────────────────────┐
                                              │  FIREBASE AUTH       │
                                              │  Validates Creds     │
                                              └──────────┬───────────┘
                                                         │
                                            ┌────────────┴────────────┐
                                            │                         │
                                            ▼                         ▼
                                 ┌──────────────────┐      ┌──────────────────┐
                                 │  VALID CREDS     │      │  INVALID CREDS   │
                                 │  Success!        │      │  Show Error      │
                                 └────────┬─────────┘      └──────────────────┘
                                          │
                                          ▼
                                 ┌──────────────────┐
                                 │  CREATE JWT      │
                                 │  SESSION TOKEN   │
                                 └────────┬─────────┘
                                          │
                                          ▼
                                 ┌──────────────────┐
                                 │  STORE SESSION   │
                                 │  (30 days)       │
                                 └────────┬─────────┘
                                          │
                                          ▼
                                 ┌──────────────────┐
                                 │  REDIRECT TO     │
                                 │  /admin          │
                                 └────────┬─────────┘
                                          │
                                          ▼
                                 ┌──────────────────┐
                                 │  ACCESS GRANTED  │
                                 │  Show Dashboard  │
                                 └──────────────────┘


╔══════════════════════════════════════════════════════════════════════════════╗
║                            LOGOUT FLOW                                        ║
╚══════════════════════════════════════════════════════════════════════════════╝

┌─────────────────────────────────────────────────────────────────────────────┐
│                    USER CLICKS "LOG OUT" BUTTON                              │
└────────────────────────────────┬────────────────────────────────────────────┘
                                 │
                                 ▼
                    ┌────────────────────────┐
                    │  signOut() Called      │
                    │  (NextAuth)            │
                    └────────────┬───────────┘
                                 │
                                 ▼
                    ┌────────────────────────┐
                    │  CLEAR JWT SESSION     │
                    │  Delete Cookies        │
                    └────────────┬───────────┘
                                 │
                                 ▼
                    ┌────────────────────────┐
                    │  REDIRECT TO HOME      │
                    │  (/)                   │
                    └────────────┬───────────┘
                                 │
                                 ▼
                    ┌────────────────────────┐
                    │  LOGGED OUT ✓          │
                    │  Session Cleared       │
                    └────────────────────────┘


╔══════════════════════════════════════════════════════════════════════════════╗
║                         COMPONENT STRUCTURE                                   ║
╚══════════════════════════════════════════════════════════════════════════════╝

┌─────────────────────────────────────────────────────────────────────────────┐
│  ROOT LAYOUT (src/app/layout.tsx)                                            │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  <SessionProvider>                                                   │    │
│  │    ┌───────────────────────────────────────────────────────────┐    │    │
│  │    │  {children} - All pages                                   │    │    │
│  │    └───────────────────────────────────────────────────────────┘    │    │
│  │  </SessionProvider>                                                  │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│  ADMIN LAYOUT (src/app/admin/layout.tsx)                                     │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  <ProtectedRoute>                                                    │    │
│  │    ┌───────────────────────────────────────────────────────────┐    │    │
│  │    │  {children} - Admin pages                                 │    │    │
│  │    │  - Dashboard                                              │    │    │
│  │    │  - Settings                                               │    │    │
│  │    └───────────────────────────────────────────────────────────┘    │    │
│  │  </ProtectedRoute>                                                   │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│  INVENTORY LAYOUT (src/app/inventory/layout.tsx)                             │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  <ProtectedRoute>                                                    │    │
│  │    ┌───────────────────────────────────────────────────────────┐    │    │
│  │    │  {children} - Inventory pages                             │    │    │
│  │    └───────────────────────────────────────────────────────────┘    │    │
│  │  </ProtectedRoute>                                                   │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────────┘


╔══════════════════════════════════════════════════════════════════════════════╗
║                         PROTECTION LAYERS                                     ║
╚══════════════════════════════════════════════════════════════════════════════╝

┌─────────────────────────────────────────────────────────────────────────────┐
│  LAYER 1: MIDDLEWARE (Server-Side)                                           │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  • Runs on every request                                            │    │
│  │  • Checks JWT token                                                 │    │
│  │  • Blocks unauthorized access                                       │    │
│  │  • Fast and secure                                                  │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────────┘
                                    ↓
┌─────────────────────────────────────────────────────────────────────────────┐
│  LAYER 2: PROTECTED ROUTE (Client-Side)                                      │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  • Checks session with useSession()                                 │    │
│  │  • Shows login modal if needed                                      │    │
│  │  • Handles loading states                                           │    │
│  │  • User-friendly experience                                         │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────────┘
                                    ↓
┌─────────────────────────────────────────────────────────────────────────────┐
│  LAYER 3: FIREBASE AUTH (Backend)                                            │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  • Validates credentials                                            │    │
│  │  • Manages user accounts                                            │    │
│  │  • Handles password security                                        │    │
│  │  • Industry-standard security                                       │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────────┘


╔══════════════════════════════════════════════════════════════════════════════╗
║                         FILE STRUCTURE                                        ║
╚══════════════════════════════════════════════════════════════════════════════╝

src/
├── middleware.ts                          ← Server-side protection
├── app/
│   ├── layout.tsx                         ← SessionProvider wrapper
│   ├── admin/
│   │   ├── layout.tsx                     ← ProtectedRoute wrapper
│   │   ├── page.tsx                       ← Dashboard (protected)
│   │   └── settings/
│   │       └── page.tsx                   ← Settings (protected)
│   ├── inventory/
│   │   ├── layout.tsx                     ← ProtectedRoute wrapper
│   │   └── page.tsx                       ← Inventory (protected)
│   ├── setup-admin/
│   │   └── page.tsx                       ← Admin creation (delete after use)
│   └── api/
│       └── auth/
│           └── [...nextauth]/
│               └── route.ts               ← NextAuth + Firebase config
├── components/
│   ├── SessionProvider.tsx                ← Session context
│   ├── ProtectedRoute.tsx                 ← Auth wrapper
│   └── LoginModal.tsx                     ← Login UI
├── types/
│   └── next-auth.d.ts                     ← TypeScript types
└── lib/
    └── firebase.ts                        ← Firebase config (existing)


╔══════════════════════════════════════════════════════════════════════════════╗
║                         QUICK REFERENCE                                       ║
╚══════════════════════════════════════════════════════════════════════════════╝

CREATE ADMIN USER:
  → Navigate to: http://localhost:3003/setup-admin
  → Fill form and submit
  → Delete src/app/setup-admin/page.tsx after

TEST LOGIN:
  → Navigate to: http://localhost:3003/admin
  → Click "Sign In"
  → Enter credentials
  → Access granted!

TEST LOGOUT:
  → Click "Log out" button
  → Redirected to home
  → Try /admin again (requires login)

PROTECTED ROUTES:
  ✓ /admin
  ✓ /admin/settings
  ✓ /inventory

PUBLIC ROUTES:
  ✓ /
  ✓ /product/[id]
  ✓ /scan

═══════════════════════════════════════════════════════════════════════════════